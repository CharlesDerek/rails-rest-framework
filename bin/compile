#!/bin/sh

# bin/compile <build-dir> <cache-dir> <env-dir>

# Used for inline Heroku buildpack.

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

# Create temp directory and move the test project into it.
mkdir -p $CACHE_DIR
TMP_DIR=`mktemp -d $CACHE_DIR/rrf_demo_XXXXXX`
echo "Temp directory: $TMP_DIR"
mv $BUILD_DIR/test $TMP_DIR/.

# Blow away build directory and replace with test
ecbo "Overwriting $BUILD_DIR with $TMP_DIR/test"
rm -rf $BUILD_DIR
mv $TMP_DIR/test $BUILD_DIR
mkdir -p $BUILD_DIR
echo "Copying work dir from cache $TMP_DIR to build dir $BUILD_DIR"
cp -R $TMP_DIR/. $BUILD_DIR/
echo "       cleaning tmp dir $TMP_DIR"
rm -rf $TMP_DIR
exit 0
